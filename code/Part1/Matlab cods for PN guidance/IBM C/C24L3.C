#include <stdio.h>
#include <stdlib.h>
#include <math.h>
main()
{
	int step,miss;
	float fr,diam,xl,ctw,crw,hw,ctt,crt,ht,xn,xcg,xhl,wact;
	float zact,tf,vm,xncg,wcr,zeta,tau,alt,xnt,xnp,vc,t1,t2;
	float phirn,phigl,phifn,ra,r,tint;
	float a,rho,wgt,xnllin,xacc,swing,stail,sref,xlp,splan,xcpn;
	float an,ab,xcpb,xcpw,xmach,xiyy,tmp1,tmp2,tmp3,tmp4,b,q;
	float p1,y1,y2,y3,y4,y5,y6,p2,p3,alftr,deltr,cna,cnd;
	float cmap,cma,cmd,xma,xmd,za,zd,wz,waf,zaf,xk1,xk2;
	float ta,xk3,w,w0,z0,xkc,xka,xk0,xk,wi,xkr,xkdc;
	float x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15;
	float t,h,s,tp,x1old,x2old,x3old,x4old,x5old,x6old,x7old,x8old;
	float x9old,x10old,x11old,x12old,x13old,x14old,x15old;
	float x1d,x2d,x3d,x4d,x5d,x6d,x7d,x8d,x9d,x10d,x11d,x12d;
	float x13d,x14d,x15d;
	float tgo,y1pz,y2pz,y4pz,y3pz,xmnt,xmfn,xmrn,xmgl,xmudnt,rms;
	FILE *fptr;
	fr=3.;
	diam=1.;
	xl=20.;
	ctw=0.;
	crw=6.;
	hw=2.;
	ctt=0.;
	crt=2.;
	ht=2.;
	xn=4.;
	xcg=10.;
	xhl=19.5;
	wact=150.;
	zact=.7;
	tf=5.;
	vm=3000.;
	xncg=10.;
	wcr=50.;
	zeta=.7;
	tau=.3;
	alt=0.;
	xnt=64.4;
	xnp=3.;
	vc=4000.;
	t1=.1;
	t2=.15;
	phirn=.000002;
	phigl=20.;
	phifn=.00000008;
	ra=30000.;
	r=0.;
	miss=1;
	tint=0.;
L106:
	fptr=fopen("DATFIL.TXT","w");
	printf("current values for altitude and autopilot time constant %f\t%f\n",alt,tau);
	printf ("enter altitude and autopilot time constant:");
	scanf ("%f %f",&alt,&tau);
	printf("you entered %f\t%f\n",alt,tau);
	a=1000.;
	if(alt<=30000.)
		rho=.002378*exp(-alt/30000.);
	else
		rho=.0034*exp(-alt/22000.);
	wgt=1000.;
	xnllin=0.;
	xacc=xcg;
	swing=.5*hw*(ctw+crw);
	stail=.5*ht*(ctt+crt);
	sref=3.1416*diam*diam/4.;
	xlp=fr*diam;
	splan=(xl-xlp)*diam+1.33*xlp*diam/2.;
	xcpn=2*xlp/3;
	an=.67*xlp*diam;
        ab=(xl-xlp)*diam;
        xcpb=(.67*an*xlp+ab*(xlp+.5*(xl-xlp)))/(an+ab);
	xcpw=xlp+xn+.7*crw-.2*ctw;
	xmach=vm/a;
	xiyy=wgt*(3*((diam/2)*(diam/2))+xl*xl)/(12*32.2);
	tmp1=(xcg-xcpw)/diam;
	tmp2=(xcg-xhl)/diam;
	tmp3=(xcg-xcpb)/diam;
	tmp4=(xcg-xcpn)/diam;
	b=sqrt(xmach*xmach-1);
	q=.5*rho*vm*vm;
	p1=wgt*xncg/(q*sref);
	y1=2+8*swing/(b*sref)+8*stail/(b*sref);
	y2=1.5*splan/sref;
	y3=8*stail/(b*sref);
	y4=2*tmp4+8*swing*tmp1/(b*sref)+8*stail*tmp2/(b*sref);
	y5=1.5*splan*tmp3/sref;
	y6=8*stail*tmp2/(b*sref);
	p2=y2-y3*y5/y6;
	p3=y1-y3*y4/y6;
	alftr=(-p3+sqrt(p3*p3+4.*p2*p1))/(2.*p2);
	deltr=-y4*alftr/y6-y5*alftr*alftr/y6;
	cna=2+1.5*splan*alftr/sref+8*swing/(b*sref)+8*stail/(b*sref);
	cnd=8*stail/(b*sref);
	cmap=2*tmp4+1.5*splan*alftr*tmp3/sref+8*swing*tmp1/(b*sref);
	cma=cmap+8*stail*tmp2/(b*sref);
	cmd=8*stail*tmp2/(b*sref);
	xma=q*sref*diam*cma/xiyy;
	xmd=q*sref*diam*cmd/xiyy;
	za=-32.2*q*sref*cna/(wgt*vm);
	zd=-32.2*q*sref*cnd/(wgt*vm);
	wz=sqrt((xma*zd-za*xmd)/zd);
	waf=sqrt(-xma);
	zaf=.5*waf*za/xma;
	xk1=-vm*(xma*zd-xmd*za)/(1845*xma);
	xk2=xk1;
	ta=xmd/(xma*zd-xmd*za);
	xk3=1845*xk1/vm;
	w=(tau*wcr*(1+2.*zaf*waf/wcr)-1)/(2*zeta*tau);
	w0=w/sqrt(tau*wcr);
	z0=.5*w0*(2*zeta/w+tau-waf*waf/(w0*w0*wcr));
	xkc=(-w0*w0/(wz*wz)-1.+2.*z0*w0*ta)/(1.-2.*z0*w0*ta+w0*w0*ta*ta);
	xka=xk3/(xk1*xkc);
	xk0=-w*w/(tau*waf*waf);
	xk=xk0/(xk1*(1+xkc));
	wi=xkc*ta*w0*w0/(1+xkc+w0*w0/(wz*wz));
	xkr=xk/(xka*wi);
	xkdc=1.+1845./(xka*vm);
	for(r=-.06;r<=.06;r=r+.005){
		x1=0.;
		x2=0.;
		x3=0.;
		x4=0.;
		x5=0.;
		x6=0.;
		x7=0.;
		x8=0.;
		x9=0.;
		x10=0.;
		x11=0.;
		x12=0.;
		x13=0.;
		x14=0.;
		x15=0.;
		if(miss==1)
			x3=1.;
		else if(miss==2)
			x8=1.;
		else if(miss==3)
			x6=xnp*vc/32.2;
		t=0;
		h=.0001;
		s=0;
		tp=t+.00001+tint;
L10:
		if(tp>(tf-.00001)) goto L999;
		s=s+h;
		x1old=x1;
		x2old=x2;
		x3old=x3;
		x4old=x4;
		x5old=x5;
		x6old=x6;
		x7old=x7;
		x8old=x8;
		x9old=x9;
		x10old=x10;
		x11old=x11;
		x12old=x12;
		x13old=x13;
		x14old=x14;
		x15old=x15;
		step=1;
		goto L200;
L66:
		step=2;
		x1=x1+h*x1d;
		x2=x2+h*x2d;
		x3=x3+h*x3d;
		x4=x4+h*x4d;
		x5=x5+h*x5d;
		x6=x6+h*x6d;
		x7=x7+h*x7d;
		x8=x8+h*x8d;
		x9=x9+h*x9d;
		x10=x10+h*x10d;
		x11=x11+h*x11d;
		x12=x12+h*x12d;
		x13=x13+h*x13d;
		x14=x14+h*x14d;
		x15=x15+h*x15d;
		tp=tp+h;
		goto L200;
L55:
		x1=.5*(x1old+x1+h*x1d);
		x2=.5*(x2old+x2+h*x2d);
		x3=.5*(x3old+x3+h*x3d);
		x4=.5*(x4old+x4+h*x4d);
		x5=.5*(x5old+x5+h*x5d);
		x6=.5*(x6old+x6+h*x6d);
		x7=.5*(x7old+x7+h*x7d);
		x8=.5*(x8old+x8+h*x8d);
		x9=.5*(x9old+x9+h*x9d);
		x10=.5*(x10old+x10+h*x10d);
		x11=.5*(x11old+x11+h*x11d);
		x12=.5*(x12old+x12+h*x12d);
		x13=.5*(x13old+x13+h*x13d);
		x14=.5*(x14old+x14+h*x14d);
		x15=.5*(x15old+x15+h*x15d);
		goto L10;
L200:
 		tgo=tp+.00001;
 		x1d=x2;
		x2d=x3;
		y1pz=(x6/t2+x5)/t1;
		x3d=y1pz/(vc*tgo);
		x4d=-y1pz;
		x5d=-y1pz+r*y1pz;
		y2pz=-xka*wi*x7;
		x6d=-x6/t2+xnp*vc*xkdc*y2pz/32.2;
		x7d=xkr*wact*wact*x8;
		x8d=x9-2.*zact*wact*x8;
		y4pz=xk1*(-32.2*x2-y2pz);
		x9d=-wact*wact*x8+x10*waf*waf-waf*waf*y4pz/(wz*wz);
		y3pz=xk3*(x7d+wi*x7+(x4-x5)/57.3);
		x10d=-2.*zaf*waf*(x10-y4pz/(wz*wz))+x11+ta*y3pz;
		x11d=-waf*waf*(x10-y4pz/(wz*wz))+y4pz+y3pz;
		x12d=x1*x1;
		x13d=(y1pz/(vc*tgo))*(y1pz/(vc*tgo));
		x14d=(y1pz*vc*tgo/ra)*(y1pz*vc*tgo/ra);
		x15d=y1pz*y1pz;
		if(step<=1)
			goto L66;
		else
			goto L55;
L999:
		xmnt=xnt*x1;
		xmfn=sqrt(x15*phifn);
		xmrn=sqrt(x14*phirn);
		xmgl=sqrt(x13*phigl);
		xmudnt=xnt*sqrt(x12/tgo);
		rms=sqrt(xmfn*xmfn+xmrn*xmrn+xmgl*xmgl+xmudnt*xmudnt);
		printf("%10.3f %10.3f %10.3f %10.3f %10.3f %10.3f \n",r,xmfn,xmrn,xmgl,xmudnt,rms);
		fprintf(fptr,"%10.3f %10.3f %10.3f %10.3f %10.3f %10.3f \n",r,xmfn,xmrn,xmgl,xmudnt,rms);
	}
 
	fclose (fptr);
	return 0;
	goto L106;
}
